{"ast":null,"code":"import WEBGL_FEATURES from './webgl-features-table';\nimport { isWebGL2, log } from '@luma.gl/gltools';\nimport { assert } from '../utils';\nvar LOG_UNSUPPORTED_FEATURE = 2;\nexport function hasFeature(gl, feature) {\n  return hasFeatures(gl, feature);\n}\nexport function hasFeatures(gl, features) {\n  features = Array.isArray(features) ? features : [features];\n  return features.every(function (feature) {\n    return isFeatureSupported(gl, feature);\n  });\n}\nexport function getFeatures(gl) {\n  gl.luma = gl.luma || {};\n  gl.luma.caps = gl.luma.caps || {};\n\n  for (var cap in WEBGL_FEATURES) {\n    if (gl.luma.caps[cap] === undefined) {\n      gl.luma.caps[cap] = isFeatureSupported(gl, cap);\n    }\n  }\n\n  return gl.luma.caps;\n}\n\nfunction isFeatureSupported(gl, cap) {\n  gl.luma = gl.luma || {};\n  gl.luma.caps = gl.luma.caps || {};\n\n  if (gl.luma.caps[cap] === undefined) {\n    gl.luma.caps[cap] = queryFeature(gl, cap);\n  }\n\n  if (!gl.luma.caps[cap]) {\n    log.log(LOG_UNSUPPORTED_FEATURE, \"Feature: \".concat(cap, \" not supported\"))();\n  }\n\n  return gl.luma.caps[cap];\n}\n\nfunction queryFeature(gl, cap) {\n  var feature = WEBGL_FEATURES[cap];\n  assert(feature, cap);\n  var isSupported;\n  var featureDefinition = isWebGL2(gl) ? feature[1] || feature[0] : feature[0];\n\n  if (typeof featureDefinition === 'function') {\n    isSupported = featureDefinition(gl);\n  } else if (Array.isArray(featureDefinition)) {\n    isSupported = true;\n    var _iteratorNormalCompletion = true;\n    var _didIteratorError = false;\n    var _iteratorError = undefined;\n\n    try {\n      for (var _iterator = featureDefinition[Symbol.iterator](), _step; !(_iteratorNormalCompletion = (_step = _iterator.next()).done); _iteratorNormalCompletion = true) {\n        var extension = _step.value;\n        isSupported = isSupported && Boolean(gl.getExtension(extension));\n      }\n    } catch (err) {\n      _didIteratorError = true;\n      _iteratorError = err;\n    } finally {\n      try {\n        if (!_iteratorNormalCompletion && _iterator[\"return\"] != null) {\n          _iterator[\"return\"]();\n        }\n      } finally {\n        if (_didIteratorError) {\n          throw _iteratorError;\n        }\n      }\n    }\n  } else if (typeof featureDefinition === 'string') {\n    isSupported = Boolean(gl.getExtension(featureDefinition));\n  } else if (typeof featureDefinition === 'boolean') {\n    isSupported = featureDefinition;\n  } else {\n    assert(false);\n  }\n\n  return isSupported;\n}","map":{"version":3,"sources":["../../../src/features/features.js"],"names":["LOG_UNSUPPORTED_FEATURE","hasFeatures","features","Array","isFeatureSupported","gl","queryFeature","log","feature","WEBGL_FEATURES","assert","featureDefinition","isWebGL2","isSupported","extension","Boolean"],"mappings":"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","sourcesContent":["// Feature detection for WebGL\n//\n// Provides a function that enables simple checking of which WebGL features are\n// available in an WebGL1 or WebGL2 environment.\n\nimport WEBGL_FEATURES from './webgl-features-table';\nimport {isWebGL2, log} from '@luma.gl/gltools';\nimport {assert} from '../utils';\n\nconst LOG_UNSUPPORTED_FEATURE = 2;\n\n// Check one feature\nexport function hasFeature(gl, feature) {\n  return hasFeatures(gl, feature);\n}\n\n// Check one or more features\nexport function hasFeatures(gl, features) {\n  features = Array.isArray(features) ? features : [features];\n  return features.every(feature => {\n    return isFeatureSupported(gl, feature);\n  });\n}\n\n// Return a list of supported features\nexport function getFeatures(gl) {\n  gl.luma = gl.luma || {};\n  gl.luma.caps = gl.luma.caps || {};\n  for (const cap in WEBGL_FEATURES) {\n    if (gl.luma.caps[cap] === undefined) {\n      gl.luma.caps[cap] = isFeatureSupported(gl, cap);\n    }\n  }\n  return gl.luma.caps;\n}\n\n// TODO - cache the value\nfunction isFeatureSupported(gl, cap) {\n  gl.luma = gl.luma || {};\n  gl.luma.caps = gl.luma.caps || {};\n\n  if (gl.luma.caps[cap] === undefined) {\n    gl.luma.caps[cap] = queryFeature(gl, cap);\n  }\n\n  if (!gl.luma.caps[cap]) {\n    log.log(LOG_UNSUPPORTED_FEATURE, `Feature: ${cap} not supported`)();\n  }\n\n  return gl.luma.caps[cap];\n}\n\nfunction queryFeature(gl, cap) {\n  const feature = WEBGL_FEATURES[cap];\n  assert(feature, cap);\n\n  let isSupported;\n\n  // Get extension name from table\n  const featureDefinition = isWebGL2(gl) ? feature[1] || feature[0] : feature[0];\n\n  // Check if the value is dependent on checking one or more extensions\n  if (typeof featureDefinition === 'function') {\n    isSupported = featureDefinition(gl);\n  } else if (Array.isArray(featureDefinition)) {\n    isSupported = true;\n    for (const extension of featureDefinition) {\n      isSupported = isSupported && Boolean(gl.getExtension(extension));\n    }\n  } else if (typeof featureDefinition === 'string') {\n    isSupported = Boolean(gl.getExtension(featureDefinition));\n  } else if (typeof featureDefinition === 'boolean') {\n    isSupported = featureDefinition;\n  } else {\n    assert(false);\n  }\n\n  return isSupported;\n}\n"]},"metadata":{},"sourceType":"module"}