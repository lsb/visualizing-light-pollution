{"ast":null,"code":"import { polyfillVertexArrayObject } from './polyfill-vertex-array-object';\nimport { assert } from '../utils';\nimport { WEBGL2_CONTEXT_POLYFILLS, WEBGL2_CONTEXT_OVERRIDES } from './polyfill-table';\nexport default function polyfillContext(gl) {\n  gl.luma = gl.luma || {};\n\n  if (!gl.luma.polyfilled) {\n    polyfillVertexArrayObject(gl);\n    initializeExtensions(gl);\n    installPolyfills(gl, WEBGL2_CONTEXT_POLYFILLS);\n    installOverrides(gl, {\n      target: gl.luma,\n      target2: gl\n    });\n    gl.luma.polyfilled = true;\n  }\n\n  return gl;\n}\nvar global_ = typeof global !== 'undefined' ? global : window;\nglobal_.polyfillContext = polyfillContext;\n\nfunction initializeExtensions(gl) {\n  gl.luma.extensions = {};\n  var EXTENSIONS = gl.getSupportedExtensions() || [];\n  var _iteratorNormalCompletion = true;\n  var _didIteratorError = false;\n  var _iteratorError = undefined;\n\n  try {\n    for (var _iterator = EXTENSIONS[Symbol.iterator](), _step; !(_iteratorNormalCompletion = (_step = _iterator.next()).done); _iteratorNormalCompletion = true) {\n      var extension = _step.value;\n      gl.luma[extension] = gl.getExtension(extension);\n    }\n  } catch (err) {\n    _didIteratorError = true;\n    _iteratorError = err;\n  } finally {\n    try {\n      if (!_iteratorNormalCompletion && _iterator[\"return\"] != null) {\n        _iterator[\"return\"]();\n      }\n    } finally {\n      if (_didIteratorError) {\n        throw _iteratorError;\n      }\n    }\n  }\n}\n\nfunction installOverrides(gl, _ref) {\n  var target = _ref.target,\n      target2 = _ref.target2;\n  Object.keys(WEBGL2_CONTEXT_OVERRIDES).forEach(function (key) {\n    if (typeof WEBGL2_CONTEXT_OVERRIDES[key] === 'function') {\n      var originalFunc = gl[key] ? gl[key].bind(gl) : function () {};\n      var polyfill = WEBGL2_CONTEXT_OVERRIDES[key].bind(null, gl, originalFunc);\n      target[key] = polyfill;\n      target2[key] = polyfill;\n    }\n  });\n}\n\nfunction installPolyfills(gl, polyfills) {\n  var _iteratorNormalCompletion2 = true;\n  var _didIteratorError2 = false;\n  var _iteratorError2 = undefined;\n\n  try {\n    for (var _iterator2 = Object.getOwnPropertyNames(polyfills)[Symbol.iterator](), _step2; !(_iteratorNormalCompletion2 = (_step2 = _iterator2.next()).done); _iteratorNormalCompletion2 = true) {\n      var extension = _step2.value;\n\n      if (extension !== 'overrides') {\n        polyfillExtension(gl, {\n          extension: extension,\n          target: gl.luma,\n          target2: gl\n        });\n      }\n    }\n  } catch (err) {\n    _didIteratorError2 = true;\n    _iteratorError2 = err;\n  } finally {\n    try {\n      if (!_iteratorNormalCompletion2 && _iterator2[\"return\"] != null) {\n        _iterator2[\"return\"]();\n      }\n    } finally {\n      if (_didIteratorError2) {\n        throw _iteratorError2;\n      }\n    }\n  }\n}\n\nfunction polyfillExtension(gl, _ref2) {\n  var extension = _ref2.extension,\n      target = _ref2.target,\n      target2 = _ref2.target2;\n  var defaults = WEBGL2_CONTEXT_POLYFILLS[extension];\n  assert(defaults);\n  var _defaults$meta = defaults.meta,\n      meta = _defaults$meta === void 0 ? {} : _defaults$meta;\n  var _meta$suffix = meta.suffix,\n      suffix = _meta$suffix === void 0 ? '' : _meta$suffix;\n  var ext = gl.getExtension(extension);\n\n  var _loop = function _loop() {\n    var key = _Object$keys[_i];\n    var extKey = \"\".concat(key).concat(suffix);\n    var polyfill = null;\n\n    if (key === 'meta') {} else if (typeof gl[key] === 'function') {} else if (ext && typeof ext[extKey] === 'function') {\n      polyfill = function polyfill() {\n        return ext[extKey].apply(ext, arguments);\n      };\n    } else if (typeof defaults[key] === 'function') {\n      polyfill = defaults[key].bind(target);\n    }\n\n    if (polyfill) {\n      target[key] = polyfill;\n      target2[key] = polyfill;\n    }\n  };\n\n  for (var _i = 0, _Object$keys = Object.keys(defaults); _i < _Object$keys.length; _i++) {\n    _loop();\n  }\n}","map":{"version":3,"sources":["../../../src/polyfill/polyfill-context.js"],"names":["gl","polyfillVertexArrayObject","initializeExtensions","installPolyfills","installOverrides","target","target2","global_","EXTENSIONS","extension","Object","WEBGL2_CONTEXT_OVERRIDES","originalFunc","polyfill","polyfillExtension","defaults","WEBGL2_CONTEXT_POLYFILLS","assert","meta","suffix","ext","key","extKey"],"mappings":"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","sourcesContent":["// WebGL1/WebGL2 extension polyfill support\n//\n// Provides a function that creates polyfills for WebGL2 functions based\n// on available extensions and installs them on a supplied target (could be\n// the WebGLContext or its prototype, or a separate object).\n//\n// This is intended to be a stand-alone file with minimal dependencies,\n// easy to reuse or repurpose in other projects.\n\n/* eslint-disable camelcase, brace-style */\nimport {polyfillVertexArrayObject} from './polyfill-vertex-array-object';\nimport {assert} from '../utils';\n\nimport {WEBGL2_CONTEXT_POLYFILLS, WEBGL2_CONTEXT_OVERRIDES} from './polyfill-table';\n\n// Registers extensions, polyfills or mock functions for extensions in the polyfills list\n// TODO - remove use of name `luma`.\nexport default function polyfillContext(gl) {\n  gl.luma = gl.luma || {};\n  if (!gl.luma.polyfilled) {\n    polyfillVertexArrayObject(gl);\n    initializeExtensions(gl);\n    installPolyfills(gl, WEBGL2_CONTEXT_POLYFILLS);\n    installOverrides(gl, {target: gl.luma, target2: gl});\n    gl.luma.polyfilled = true;\n  }\n  return gl;\n}\n\n// TODO - is this still required?\n/* global window, global */\nconst global_ = typeof global !== 'undefined' ? global : window;\nglobal_.polyfillContext = polyfillContext;\n\nfunction initializeExtensions(gl) {\n  gl.luma.extensions = {};\n  // `getSupportedExtensions` can return null when context is lost.\n  const EXTENSIONS = gl.getSupportedExtensions() || [];\n  for (const extension of EXTENSIONS) {\n    gl.luma[extension] = gl.getExtension(extension);\n  }\n}\n\n// Install simple overrides (mostly get* functions)\nfunction installOverrides(gl, {target, target2}) {\n  Object.keys(WEBGL2_CONTEXT_OVERRIDES).forEach(key => {\n    if (typeof WEBGL2_CONTEXT_OVERRIDES[key] === 'function') {\n      // install an override, if no implementation was detected\n      const originalFunc = gl[key] ? gl[key].bind(gl) : () => {};\n      const polyfill = WEBGL2_CONTEXT_OVERRIDES[key].bind(null, gl, originalFunc);\n      target[key] = polyfill;\n      target2[key] = polyfill;\n    }\n  });\n}\n\nfunction installPolyfills(gl, polyfills) {\n  for (const extension of Object.getOwnPropertyNames(polyfills)) {\n    if (extension !== 'overrides') {\n      polyfillExtension(gl, {extension, target: gl.luma, target2: gl});\n    }\n  }\n}\n\n// Polyfills a single WebGL extension into the `target` object\nfunction polyfillExtension(gl, {extension, target, target2}) {\n  const defaults = WEBGL2_CONTEXT_POLYFILLS[extension];\n  assert(defaults);\n\n  const {meta = {}} = defaults;\n  const {suffix = ''} = meta;\n\n  const ext = gl.getExtension(extension);\n\n  for (const key of Object.keys(defaults)) {\n    const extKey = `${key}${suffix}`;\n\n    let polyfill = null;\n    if (key === 'meta') {\n      // ignore\n    } else if (typeof gl[key] === 'function') {\n      // WebGL2 implementation is already\n    } else if (ext && typeof ext[extKey] === 'function') {\n      // pick extension implemenentation,if available\n      polyfill = (...args) => ext[extKey](...args);\n    } else if (typeof defaults[key] === 'function') {\n      // pick the mock implementation, if no implementation was detected\n      polyfill = defaults[key].bind(target);\n    }\n\n    if (polyfill) {\n      target[key] = polyfill;\n      target2[key] = polyfill;\n    }\n  }\n}\n"]},"metadata":{},"sourceType":"module"}