{"ast":null,"code":"import _typeof from \"@babel/runtime/helpers/esm/typeof\";\nimport { PROP_SYMBOLS } from './constants';\nvar COMPONENT = PROP_SYMBOLS.COMPONENT;\nexport function validateProps(props) {\n  var propTypes = getPropTypes(props);\n\n  for (var propName in propTypes) {\n    var propType = propTypes[propName];\n    var validate = propType.validate;\n\n    if (validate && !validate(props[propName], propType)) {\n      throw new Error(\"Invalid prop \".concat(propName, \": \").concat(props[propName]));\n    }\n  }\n}\nexport function diffProps(props, oldProps) {\n  var propsChangedReason = compareProps({\n    newProps: props,\n    oldProps: oldProps,\n    propTypes: getPropTypes(props),\n    ignoreProps: {\n      data: null,\n      updateTriggers: null,\n      extensions: null,\n      transitions: null\n    }\n  });\n  var dataChangedReason = diffDataProps(props, oldProps);\n  var updateTriggersChangedReason = false;\n\n  if (!dataChangedReason) {\n    updateTriggersChangedReason = diffUpdateTriggers(props, oldProps);\n  }\n\n  return {\n    dataChanged: dataChangedReason,\n    propsChanged: propsChangedReason,\n    updateTriggersChanged: updateTriggersChangedReason,\n    extensionsChanged: diffExtensions(props, oldProps),\n    transitionsChanged: diffTransitions(props, oldProps)\n  };\n}\n\nfunction diffTransitions(props, oldProps) {\n  if (!props.transitions) {\n    return null;\n  }\n\n  var result = {};\n  var propTypes = getPropTypes(props);\n\n  for (var key in props.transitions) {\n    var propType = propTypes[key];\n    var type = propType && propType.type;\n    var isTransitionable = type === 'number' || type === 'color' || type === 'array';\n\n    if (isTransitionable && comparePropValues(props[key], oldProps[key], propType)) {\n      result[key] = true;\n    }\n  }\n\n  return result;\n}\n\nexport function compareProps() {\n  var _ref = arguments.length > 0 && arguments[0] !== undefined ? arguments[0] : {},\n      newProps = _ref.newProps,\n      oldProps = _ref.oldProps,\n      _ref$ignoreProps = _ref.ignoreProps,\n      ignoreProps = _ref$ignoreProps === void 0 ? {} : _ref$ignoreProps,\n      _ref$propTypes = _ref.propTypes,\n      propTypes = _ref$propTypes === void 0 ? {} : _ref$propTypes,\n      _ref$triggerName = _ref.triggerName,\n      triggerName = _ref$triggerName === void 0 ? 'props' : _ref$triggerName;\n\n  if (oldProps === newProps) {\n    return null;\n  }\n\n  if (_typeof(newProps) !== 'object' || newProps === null) {\n    return \"\".concat(triggerName, \" changed shallowly\");\n  }\n\n  if (_typeof(oldProps) !== 'object' || oldProps === null) {\n    return \"\".concat(triggerName, \" changed shallowly\");\n  }\n\n  for (var _i = 0, _Object$keys = Object.keys(newProps); _i < _Object$keys.length; _i++) {\n    var key = _Object$keys[_i];\n\n    if (!(key in ignoreProps)) {\n      if (!(key in oldProps)) {\n        return \"\".concat(triggerName, \".\").concat(key, \" added\");\n      }\n\n      var changed = comparePropValues(newProps[key], oldProps[key], propTypes[key]);\n\n      if (changed) {\n        return \"\".concat(triggerName, \".\").concat(key, \" \").concat(changed);\n      }\n    }\n  }\n\n  for (var _i2 = 0, _Object$keys2 = Object.keys(oldProps); _i2 < _Object$keys2.length; _i2++) {\n    var _key = _Object$keys2[_i2];\n\n    if (!(_key in ignoreProps)) {\n      if (!(_key in newProps)) {\n        return \"\".concat(triggerName, \".\").concat(_key, \" dropped\");\n      }\n\n      if (!Object.hasOwnProperty.call(newProps, _key)) {\n        var _changed = comparePropValues(newProps[_key], oldProps[_key], propTypes[_key]);\n\n        if (_changed) {\n          return \"\".concat(triggerName, \".\").concat(_key, \" \").concat(_changed);\n        }\n      }\n    }\n  }\n\n  return null;\n}\n\nfunction comparePropValues(newProp, oldProp, propType) {\n  var equal = propType && propType.equal;\n\n  if (equal && !equal(newProp, oldProp, propType)) {\n    return 'changed deeply';\n  }\n\n  if (!equal) {\n    equal = newProp && oldProp && newProp.equals;\n\n    if (equal && !equal.call(newProp, oldProp)) {\n      return 'changed deeply';\n    }\n  }\n\n  if (!equal && oldProp !== newProp) {\n    return 'changed shallowly';\n  }\n\n  return null;\n}\n\nfunction diffDataProps(props, oldProps) {\n  if (oldProps === null) {\n    return 'oldProps is null, initial diff';\n  }\n\n  var dataChanged = null;\n  var dataComparator = props.dataComparator,\n      _dataDiff = props._dataDiff;\n\n  if (dataComparator) {\n    if (!dataComparator(props.data, oldProps.data)) {\n      dataChanged = 'Data comparator detected a change';\n    }\n  } else if (props.data !== oldProps.data) {\n    dataChanged = 'A new data container was supplied';\n  }\n\n  if (dataChanged && _dataDiff) {\n    dataChanged = _dataDiff(props.data, oldProps.data) || dataChanged;\n  }\n\n  return dataChanged;\n}\n\nfunction diffUpdateTriggers(props, oldProps) {\n  if (oldProps === null) {\n    return 'oldProps is null, initial diff';\n  }\n\n  if ('all' in props.updateTriggers) {\n    var diffReason = diffUpdateTrigger(props, oldProps, 'all');\n\n    if (diffReason) {\n      return {\n        all: true\n      };\n    }\n  }\n\n  var triggerChanged = {};\n  var reason = false;\n\n  for (var triggerName in props.updateTriggers) {\n    if (triggerName !== 'all') {\n      var _diffReason = diffUpdateTrigger(props, oldProps, triggerName);\n\n      if (_diffReason) {\n        triggerChanged[triggerName] = true;\n        reason = triggerChanged;\n      }\n    }\n  }\n\n  return reason;\n}\n\nfunction diffExtensions(props, oldProps) {\n  if (oldProps === null) {\n    return 'oldProps is null, initial diff';\n  }\n\n  var oldExtensions = oldProps.extensions;\n  var extensions = props.extensions;\n\n  if (extensions === oldExtensions) {\n    return false;\n  }\n\n  if (extensions.length !== oldExtensions.length) {\n    return true;\n  }\n\n  for (var i = 0; i < extensions.length; i++) {\n    if (!extensions[i].equals(oldExtensions[i])) {\n      return true;\n    }\n  }\n\n  return false;\n}\n\nfunction diffUpdateTrigger(props, oldProps, triggerName) {\n  var newTriggers = props.updateTriggers[triggerName];\n  newTriggers = newTriggers === undefined || newTriggers === null ? {} : newTriggers;\n  var oldTriggers = oldProps.updateTriggers[triggerName];\n  oldTriggers = oldTriggers === undefined || oldTriggers === null ? {} : oldTriggers;\n  var diffReason = compareProps({\n    oldProps: oldTriggers,\n    newProps: newTriggers,\n    triggerName: triggerName\n  });\n  return diffReason;\n}\n\nfunction getPropTypes(props) {\n  var layer = props[COMPONENT];\n  var LayerType = layer && layer.constructor;\n  return LayerType ? LayerType._propTypes : {};\n}","map":{"version":3,"sources":["../../../src/lifecycle/props.js"],"names":["COMPONENT","PROP_SYMBOLS","propTypes","getPropTypes","propType","validate","props","propsChangedReason","compareProps","newProps","oldProps","ignoreProps","data","updateTriggers","extensions","transitions","dataChangedReason","diffDataProps","updateTriggersChangedReason","diffUpdateTriggers","dataChanged","propsChanged","updateTriggersChanged","extensionsChanged","diffExtensions","transitionsChanged","diffTransitions","result","type","isTransitionable","comparePropValues","triggerName","key","Object","changed","equal","newProp","oldProp","dataComparator","_dataDiff","diffReason","diffUpdateTrigger","all","triggerChanged","reason","oldExtensions","i","newTriggers","oldTriggers","layer","LayerType"],"mappings":";AAAA,SAAA,YAAA,QAAA,aAAA;IAEOA,S,GAAaC,Y,CAAbD,S;AAEP,OAAO,SAAA,aAAA,CAAA,KAAA,EAA8B;AACnC,MAAME,SAAS,GAAGC,YAAY,CAA9B,KAA8B,CAA9B;;AAEA,OAAK,IAAL,QAAA,IAAA,SAAA,EAAkC;AAChC,QAAMC,QAAQ,GAAGF,SAAS,CAA1B,QAA0B,CAA1B;AADgC,QAEzBG,QAFyB,GAEbD,QAFa,CAAA,QAAA;;AAGhC,QAAIC,QAAQ,IAAI,CAACA,QAAQ,CAACC,KAAK,CAAN,QAAM,CAAN,EAAzB,QAAyB,CAAzB,EAAsD;AACpD,YAAM,IAAA,KAAA,CAAA,gBAAA,MAAA,CAAA,QAAA,EAAA,IAAA,EAAA,MAAA,CAAuCA,KAAK,CAAlD,QAAkD,CAA5C,CAAA,CAAN;AACD;AACF;AACF;AAGD,OAAO,SAAA,SAAA,CAAA,KAAA,EAAA,QAAA,EAAoC;AAEzC,MAAMC,kBAAkB,GAAGC,YAAY,CAAC;AACtCC,IAAAA,QAAQ,EAD8B,KAAA;AAEtCC,IAAAA,QAAQ,EAF8B,QAAA;AAGtCR,IAAAA,SAAS,EAAEC,YAAY,CAHe,KAGf,CAHe;AAItCQ,IAAAA,WAAW,EAAE;AAACC,MAAAA,IAAI,EAAL,IAAA;AAAaC,MAAAA,cAAc,EAA3B,IAAA;AAAmCC,MAAAA,UAAU,EAA7C,IAAA;AAAqDC,MAAAA,WAAW,EAAE;AAAlE;AAJyB,GAAD,CAAvC;AAQA,MAAMC,iBAAiB,GAAGC,aAAa,CAAA,KAAA,EAAvC,QAAuC,CAAvC;AAIA,MAAIC,2BAA2B,GAA/B,KAAA;;AACA,MAAI,CAAJ,iBAAA,EAAwB;AACtBA,IAAAA,2BAA2B,GAAGC,kBAAkB,CAAA,KAAA,EAAhDD,QAAgD,CAAhDA;AACD;;AAED,SAAO;AACLE,IAAAA,WAAW,EADN,iBAAA;AAELC,IAAAA,YAAY,EAFP,kBAAA;AAGLC,IAAAA,qBAAqB,EAHhB,2BAAA;AAILC,IAAAA,iBAAiB,EAAEC,cAAc,CAAA,KAAA,EAJ5B,QAI4B,CAJ5B;AAKLC,IAAAA,kBAAkB,EAAEC,eAAe,CAAA,KAAA,EAAA,QAAA;AAL9B,GAAP;AAOD;;AAED,SAAA,eAAA,CAAA,KAAA,EAAA,QAAA,EAA0C;AACxC,MAAI,CAACpB,KAAK,CAAV,WAAA,EAAwB;AACtB,WAAA,IAAA;AACD;;AACD,MAAMqB,MAAM,GAAZ,EAAA;AACA,MAAMzB,SAAS,GAAGC,YAAY,CAA9B,KAA8B,CAA9B;;AAEA,OAAK,IAAL,GAAA,IAAkBG,KAAK,CAAvB,WAAA,EAAqC;AACnC,QAAMF,QAAQ,GAAGF,SAAS,CAA1B,GAA0B,CAA1B;AACA,QAAM0B,IAAI,GAAGxB,QAAQ,IAAIA,QAAQ,CAAjC,IAAA;AACA,QAAMyB,gBAAgB,GAAGD,IAAI,KAAJA,QAAAA,IAAqBA,IAAI,KAAzBA,OAAAA,IAAyCA,IAAI,KAAtE,OAAA;;AACA,QAAIC,gBAAgB,IAAIC,iBAAiB,CAACxB,KAAK,CAAN,GAAM,CAAN,EAAaI,QAAQ,CAArB,GAAqB,CAArB,EAAzC,QAAyC,CAAzC,EAAgF;AAC9EiB,MAAAA,MAAM,CAANA,GAAM,CAANA,GAAAA,IAAAA;AACD;AACF;;AACD,SAAA,MAAA;AACD;;AAiBD,OAAO,SAAA,YAAA,GAMC;AAAA,MAAA,IAAA,GAAA,SAAA,CAAA,MAAA,GAAA,CAAA,IAAA,SAAA,CAAA,CAAA,CAAA,KAAA,SAAA,GAAA,SAAA,CAAA,CAAA,CAAA,GAAJ,EAAI;AAAA,MALNlB,QAKM,GAAA,IAAA,CALNA,QAKM;AAAA,MAJNC,QAIM,GAAA,IAAA,CAJNA,QAIM;AAAA,MAAA,gBAAA,GAAA,IAAA,CAHNC,WAGM;AAAA,MAHNA,WAGM,GAAA,gBAAA,KAAA,KAAA,CAAA,GAHQ,EAGR,GAAA,gBAAA;AAAA,MAAA,cAAA,GAAA,IAAA,CAFNT,SAEM;AAAA,MAFNA,SAEM,GAAA,cAAA,KAAA,KAAA,CAAA,GAFM,EAEN,GAAA,cAAA;AAAA,MAAA,gBAAA,GAAA,IAAA,CADN6B,WACM;AAAA,MADNA,WACM,GAAA,gBAAA,KAAA,KAAA,CAAA,GADQ,OACR,GAAA,gBAAA;;AAEN,MAAIrB,QAAQ,KAAZ,QAAA,EAA2B;AACzB,WAAA,IAAA;AACD;;AAGD,MAAI,OAAA,CAAA,QAAA,CAAA,KAAA,QAAA,IAAgCD,QAAQ,KAA5C,IAAA,EAAuD;AACrD,WAAA,GAAA,MAAA,CAAA,WAAA,EAAA,oBAAA,CAAA;AACD;;AAED,MAAI,OAAA,CAAA,QAAA,CAAA,KAAA,QAAA,IAAgCC,QAAQ,KAA5C,IAAA,EAAuD;AACrD,WAAA,GAAA,MAAA,CAAA,WAAA,EAAA,oBAAA,CAAA;AACD;;AAGD,OAAA,IAAA,EAAA,GAAA,CAAA,EAAA,YAAA,GAAkBuB,MAAM,CAANA,IAAAA,CAAlB,QAAkBA,CAAlB,EAAA,EAAA,GAAA,YAAA,CAAA,MAAA,EAAA,EAAA,EAAA,EAAyC;AAApC,QAAMD,GAAG,GAAA,YAAA,CAAT,EAAS,CAAT;;AACH,QAAI,EAAEA,GAAG,IAAT,WAAI,CAAJ,EAA2B;AACzB,UAAI,EAAEA,GAAG,IAAT,QAAI,CAAJ,EAAwB;AACtB,eAAA,GAAA,MAAA,CAAA,WAAA,EAAA,GAAA,EAAA,MAAA,CAAA,GAAA,EAAA,QAAA,CAAA;AACD;;AACD,UAAME,OAAO,GAAGJ,iBAAiB,CAACrB,QAAQ,CAAT,GAAS,CAAT,EAAgBC,QAAQ,CAAxB,GAAwB,CAAxB,EAA+BR,SAAS,CAAzE,GAAyE,CAAxC,CAAjC;;AACA,UAAA,OAAA,EAAa;AACX,eAAA,GAAA,MAAA,CAAA,WAAA,EAAA,GAAA,EAAA,MAAA,CAAA,GAAA,EAAA,GAAA,EAAA,MAAA,CAAA,OAAA,CAAA;AACD;AACF;AACF;;AAGD,OAAA,IAAA,GAAA,GAAA,CAAA,EAAA,aAAA,GAAkB+B,MAAM,CAANA,IAAAA,CAAlB,QAAkBA,CAAlB,EAAA,GAAA,GAAA,aAAA,CAAA,MAAA,EAAA,GAAA,EAAA,EAAyC;AAApC,QAAMD,IAAG,GAAA,aAAA,CAAT,GAAS,CAAT;;AACH,QAAI,EAAEA,IAAG,IAAT,WAAI,CAAJ,EAA2B;AACzB,UAAI,EAAEA,IAAG,IAAT,QAAI,CAAJ,EAAwB;AACtB,eAAA,GAAA,MAAA,CAAA,WAAA,EAAA,GAAA,EAAA,MAAA,CAAA,IAAA,EAAA,UAAA,CAAA;AACD;;AACD,UAAI,CAACC,MAAM,CAANA,cAAAA,CAAAA,IAAAA,CAAAA,QAAAA,EAAL,IAAKA,CAAL,EAAgD;AAE9C,YAAMC,QAAO,GAAGJ,iBAAiB,CAACrB,QAAQ,CAAT,IAAS,CAAT,EAAgBC,QAAQ,CAAxB,IAAwB,CAAxB,EAA+BR,SAAS,CAAzE,IAAyE,CAAxC,CAAjC;;AACA,YAAA,QAAA,EAAa;AACX,iBAAA,GAAA,MAAA,CAAA,WAAA,EAAA,GAAA,EAAA,MAAA,CAAA,IAAA,EAAA,GAAA,EAAA,MAAA,CAAA,QAAA,CAAA;AACD;AACF;AACF;AACF;;AAED,SAAA,IAAA;AACD;;AAID,SAAA,iBAAA,CAAA,OAAA,EAAA,OAAA,EAAA,QAAA,EAAuD;AAErD,MAAIiC,KAAK,GAAG/B,QAAQ,IAAIA,QAAQ,CAAhC,KAAA;;AACA,MAAI+B,KAAK,IAAI,CAACA,KAAK,CAAA,OAAA,EAAA,OAAA,EAAnB,QAAmB,CAAnB,EAAiD;AAC/C,WAAA,gBAAA;AACD;;AAED,MAAI,CAAJ,KAAA,EAAY;AAEVA,IAAAA,KAAK,GAAGC,OAAO,IAAPA,OAAAA,IAAsBA,OAAO,CAArCD,MAAAA;;AACA,QAAIA,KAAK,IAAI,CAACA,KAAK,CAALA,IAAAA,CAAAA,OAAAA,EAAd,OAAcA,CAAd,EAA4C;AAC1C,aAAA,gBAAA;AACD;AACF;;AAED,MAAI,CAAA,KAAA,IAAUE,OAAO,KAArB,OAAA,EAAmC;AACjC,WAAA,mBAAA;AACD;;AAED,SAAA,IAAA;AACD;;AAID,SAAA,aAAA,CAAA,KAAA,EAAA,QAAA,EAAwC;AACtC,MAAI3B,QAAQ,KAAZ,IAAA,EAAuB;AACrB,WAAA,gCAAA;AACD;;AAED,MAAIU,WAAW,GAAf,IAAA;AALsC,MAO/BkB,cAP+B,GAOFhC,KAPE,CAAA,cAAA;AAAA,MAOfiC,SAPe,GAOFjC,KAPE,CAAA,SAAA;;AAQtC,MAAA,cAAA,EAAoB;AAClB,QAAI,CAACgC,cAAc,CAAChC,KAAK,CAAN,IAAA,EAAaI,QAAQ,CAAxC,IAAmB,CAAnB,EAAgD;AAC9CU,MAAAA,WAAW,GAAXA,mCAAAA;AACD;AAHH,GAAA,MAKO,IAAId,KAAK,CAALA,IAAAA,KAAeI,QAAQ,CAA3B,IAAA,EAAkC;AACvCU,IAAAA,WAAW,GAAXA,mCAAAA;AACD;;AACD,MAAIA,WAAW,IAAf,SAAA,EAA8B;AAC5BA,IAAAA,WAAW,GAAGmB,SAAS,CAACjC,KAAK,CAAN,IAAA,EAAaI,QAAQ,CAA9B6B,IAAS,CAATA,IAAdnB,WAAAA;AACD;;AAED,SAAA,WAAA;AACD;;AAID,SAAA,kBAAA,CAAA,KAAA,EAAA,QAAA,EAA6C;AAC3C,MAAIV,QAAQ,KAAZ,IAAA,EAAuB;AACrB,WAAA,gCAAA;AACD;;AAGD,MAAI,SAASJ,KAAK,CAAlB,cAAA,EAAmC;AACjC,QAAMkC,UAAU,GAAGC,iBAAiB,CAAA,KAAA,EAAA,QAAA,EAApC,KAAoC,CAApC;;AACA,QAAA,UAAA,EAAgB;AACd,aAAO;AAACC,QAAAA,GAAG,EAAE;AAAN,OAAP;AACD;AACF;;AAED,MAAMC,cAAc,GAApB,EAAA;AACA,MAAIC,MAAM,GAAV,KAAA;;AAEA,OAAK,IAAL,WAAA,IAA0BtC,KAAK,CAA/B,cAAA,EAAgD;AAC9C,QAAIyB,WAAW,KAAf,KAAA,EAA2B;AACzB,UAAMS,WAAU,GAAGC,iBAAiB,CAAA,KAAA,EAAA,QAAA,EAApC,WAAoC,CAApC;;AACA,UAAA,WAAA,EAAgB;AACdE,QAAAA,cAAc,CAAdA,WAAc,CAAdA,GAAAA,IAAAA;AACAC,QAAAA,MAAM,GAANA,cAAAA;AACD;AACF;AACF;;AAED,SAAA,MAAA;AACD;;AAGD,SAAA,cAAA,CAAA,KAAA,EAAA,QAAA,EAAyC;AACvC,MAAIlC,QAAQ,KAAZ,IAAA,EAAuB;AACrB,WAAA,gCAAA;AACD;;AAED,MAAMmC,aAAa,GAAGnC,QAAQ,CAA9B,UAAA;AALuC,MAMhCI,UANgC,GAMlBR,KANkB,CAAA,UAAA;;AAQvC,MAAIQ,UAAU,KAAd,aAAA,EAAkC;AAChC,WAAA,KAAA;AACD;;AACD,MAAIA,UAAU,CAAVA,MAAAA,KAAsB+B,aAAa,CAAvC,MAAA,EAAgD;AAC9C,WAAA,IAAA;AACD;;AACD,OAAK,IAAIC,CAAC,GAAV,CAAA,EAAgBA,CAAC,GAAGhC,UAAU,CAA9B,MAAA,EAAuCgC,CAAvC,EAAA,EAA4C;AAC1C,QAAI,CAAChC,UAAU,CAAVA,CAAU,CAAVA,CAAAA,MAAAA,CAAqB+B,aAAa,CAAvC,CAAuC,CAAlC/B,CAAL,EAA6C;AAC3C,aAAA,IAAA;AACD;AACF;;AACD,SAAA,KAAA;AACD;;AAED,SAAA,iBAAA,CAAA,KAAA,EAAA,QAAA,EAAA,WAAA,EAAyD;AACvD,MAAIiC,WAAW,GAAGzC,KAAK,CAALA,cAAAA,CAAlB,WAAkBA,CAAlB;AACAyC,EAAAA,WAAW,GAAGA,WAAW,KAAXA,SAAAA,IAA6BA,WAAW,KAAxCA,IAAAA,GAAAA,EAAAA,GAAdA,WAAAA;AACA,MAAIC,WAAW,GAAGtC,QAAQ,CAARA,cAAAA,CAAlB,WAAkBA,CAAlB;AACAsC,EAAAA,WAAW,GAAGA,WAAW,KAAXA,SAAAA,IAA6BA,WAAW,KAAxCA,IAAAA,GAAAA,EAAAA,GAAdA,WAAAA;AACA,MAAMR,UAAU,GAAGhC,YAAY,CAAC;AAC9BE,IAAAA,QAAQ,EADsB,WAAA;AAE9BD,IAAAA,QAAQ,EAFsB,WAAA;AAG9BsB,IAAAA,WAAW,EAAXA;AAH8B,GAAD,CAA/B;AAKA,SAAA,UAAA;AACD;;AAED,SAAA,YAAA,CAAA,KAAA,EAA6B;AAC3B,MAAMkB,KAAK,GAAG3C,KAAK,CAAnB,SAAmB,CAAnB;AACA,MAAM4C,SAAS,GAAGD,KAAK,IAAIA,KAAK,CAAhC,WAAA;AACA,SAAOC,SAAS,GAAGA,SAAS,CAAZ,UAAA,GAAhB,EAAA;AACD","sourcesContent":["import {PROP_SYMBOLS} from './constants';\n\nconst {COMPONENT} = PROP_SYMBOLS;\n\nexport function validateProps(props) {\n  const propTypes = getPropTypes(props);\n\n  for (const propName in propTypes) {\n    const propType = propTypes[propName];\n    const {validate} = propType;\n    if (validate && !validate(props[propName], propType)) {\n      throw new Error(`Invalid prop ${propName}: ${props[propName]}`);\n    }\n  }\n}\n\n// Returns an object with \"change flags\", either false or strings indicating reason for change\nexport function diffProps(props, oldProps) {\n  // First check if any props have changed (ignore props that will be examined separately)\n  const propsChangedReason = compareProps({\n    newProps: props,\n    oldProps,\n    propTypes: getPropTypes(props),\n    ignoreProps: {data: null, updateTriggers: null, extensions: null, transitions: null}\n  });\n\n  // Now check if any data related props have changed\n  const dataChangedReason = diffDataProps(props, oldProps);\n\n  // Check update triggers to determine if any attributes need regeneration\n  // Note - if data has changed, all attributes will need regeneration, so skip this step\n  let updateTriggersChangedReason = false;\n  if (!dataChangedReason) {\n    updateTriggersChangedReason = diffUpdateTriggers(props, oldProps);\n  }\n\n  return {\n    dataChanged: dataChangedReason,\n    propsChanged: propsChangedReason,\n    updateTriggersChanged: updateTriggersChangedReason,\n    extensionsChanged: diffExtensions(props, oldProps),\n    transitionsChanged: diffTransitions(props, oldProps)\n  };\n}\n\nfunction diffTransitions(props, oldProps) {\n  if (!props.transitions) {\n    return null;\n  }\n  const result = {};\n  const propTypes = getPropTypes(props);\n\n  for (const key in props.transitions) {\n    const propType = propTypes[key];\n    const type = propType && propType.type;\n    const isTransitionable = type === 'number' || type === 'color' || type === 'array';\n    if (isTransitionable && comparePropValues(props[key], oldProps[key], propType)) {\n      result[key] = true;\n    }\n  }\n  return result;\n}\n\n/**\n * Performs equality by iterating through keys on an object and returning false\n * when any key has values which are not strictly equal between the arguments.\n * @param {Object} opt.oldProps - object with old key/value pairs\n * @param {Object} opt.newProps - object with new key/value pairs\n * @param {Object} opt.ignoreProps={} - object, keys that should not be compared\n * @returns {null|String} - null when values of all keys are strictly equal.\n *   if unequal, returns a string explaining what changed.\n */\n/* eslint-disable max-statements, max-depth, complexity */\n/*\n * Note: for better performance, this function assumes that both oldProps and newProps\n   inherit the same prototype (defaultProps). That is, if neither object contains own\n   property <key>, assume `oldProps.<key>` and `newProps.<key>` are equal.\n */\nexport function compareProps({\n  newProps,\n  oldProps,\n  ignoreProps = {},\n  propTypes = {},\n  triggerName = 'props'\n} = {}) {\n  // shallow equality => deep equality\n  if (oldProps === newProps) {\n    return null;\n  }\n\n  // TODO - do we need these checks? Should never happen...\n  if (typeof newProps !== 'object' || newProps === null) {\n    return `${triggerName} changed shallowly`;\n  }\n\n  if (typeof oldProps !== 'object' || oldProps === null) {\n    return `${triggerName} changed shallowly`;\n  }\n\n  // Compare explicitly defined new props against old/default values\n  for (const key of Object.keys(newProps)) {\n    if (!(key in ignoreProps)) {\n      if (!(key in oldProps)) {\n        return `${triggerName}.${key} added`;\n      }\n      const changed = comparePropValues(newProps[key], oldProps[key], propTypes[key]);\n      if (changed) {\n        return `${triggerName}.${key} ${changed}`;\n      }\n    }\n  }\n\n  // Test if any old props have been dropped\n  for (const key of Object.keys(oldProps)) {\n    if (!(key in ignoreProps)) {\n      if (!(key in newProps)) {\n        return `${triggerName}.${key} dropped`;\n      }\n      if (!Object.hasOwnProperty.call(newProps, key)) {\n        // Compare dropped old prop against default value\n        const changed = comparePropValues(newProps[key], oldProps[key], propTypes[key]);\n        if (changed) {\n          return `${triggerName}.${key} ${changed}`;\n        }\n      }\n    }\n  }\n\n  return null;\n}\n/* eslint-enable max-statements, max-depth, complexity */\n\n// HELPERS\nfunction comparePropValues(newProp, oldProp, propType) {\n  // If prop type has an equal function, invoke it\n  let equal = propType && propType.equal;\n  if (equal && !equal(newProp, oldProp, propType)) {\n    return 'changed deeply';\n  }\n\n  if (!equal) {\n    // If object has an equals function, invoke it\n    equal = newProp && oldProp && newProp.equals;\n    if (equal && !equal.call(newProp, oldProp)) {\n      return 'changed deeply';\n    }\n  }\n\n  if (!equal && oldProp !== newProp) {\n    return 'changed shallowly';\n  }\n\n  return null;\n}\n\n// The comparison of the data prop requires special handling\n// the dataComparator should be used if supplied\nfunction diffDataProps(props, oldProps) {\n  if (oldProps === null) {\n    return 'oldProps is null, initial diff';\n  }\n\n  let dataChanged = null;\n  // Support optional app defined comparison of data\n  const {dataComparator, _dataDiff} = props;\n  if (dataComparator) {\n    if (!dataComparator(props.data, oldProps.data)) {\n      dataChanged = 'Data comparator detected a change';\n    }\n    // Otherwise, do a shallow equal on props\n  } else if (props.data !== oldProps.data) {\n    dataChanged = 'A new data container was supplied';\n  }\n  if (dataChanged && _dataDiff) {\n    dataChanged = _dataDiff(props.data, oldProps.data) || dataChanged;\n  }\n\n  return dataChanged;\n}\n\n// Checks if any update triggers have changed\n// also calls callback to invalidate attributes accordingly.\nfunction diffUpdateTriggers(props, oldProps) {\n  if (oldProps === null) {\n    return 'oldProps is null, initial diff';\n  }\n\n  // If the 'all' updateTrigger fires, ignore testing others\n  if ('all' in props.updateTriggers) {\n    const diffReason = diffUpdateTrigger(props, oldProps, 'all');\n    if (diffReason) {\n      return {all: true};\n    }\n  }\n\n  const triggerChanged = {};\n  let reason = false;\n  // If the 'all' updateTrigger didn't fire, need to check all others\n  for (const triggerName in props.updateTriggers) {\n    if (triggerName !== 'all') {\n      const diffReason = diffUpdateTrigger(props, oldProps, triggerName);\n      if (diffReason) {\n        triggerChanged[triggerName] = true;\n        reason = triggerChanged;\n      }\n    }\n  }\n\n  return reason;\n}\n\n// Returns true if any extensions have changed\nfunction diffExtensions(props, oldProps) {\n  if (oldProps === null) {\n    return 'oldProps is null, initial diff';\n  }\n\n  const oldExtensions = oldProps.extensions;\n  const {extensions} = props;\n\n  if (extensions === oldExtensions) {\n    return false;\n  }\n  if (extensions.length !== oldExtensions.length) {\n    return true;\n  }\n  for (let i = 0; i < extensions.length; i++) {\n    if (!extensions[i].equals(oldExtensions[i])) {\n      return true;\n    }\n  }\n  return false;\n}\n\nfunction diffUpdateTrigger(props, oldProps, triggerName) {\n  let newTriggers = props.updateTriggers[triggerName];\n  newTriggers = newTriggers === undefined || newTriggers === null ? {} : newTriggers;\n  let oldTriggers = oldProps.updateTriggers[triggerName];\n  oldTriggers = oldTriggers === undefined || oldTriggers === null ? {} : oldTriggers;\n  const diffReason = compareProps({\n    oldProps: oldTriggers,\n    newProps: newTriggers,\n    triggerName\n  });\n  return diffReason;\n}\n\nfunction getPropTypes(props) {\n  const layer = props[COMPONENT];\n  const LayerType = layer && layer.constructor;\n  return LayerType ? LayerType._propTypes : {};\n}\n"]},"metadata":{},"sourceType":"module"}