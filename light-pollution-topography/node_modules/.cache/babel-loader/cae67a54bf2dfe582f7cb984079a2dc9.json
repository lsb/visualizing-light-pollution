{"ast":null,"code":"var _jsxFileName = \"/home/lsb/wikidatageo/dark-sky-vacations/src/App.js\";\nimport React from 'react';\nimport './App.css';\nimport DeckGL from '@deck.gl/react';\nimport { TerrainLayer, TileLayer } from '@deck.gl/geo-layers';\nimport { BitmapLayer } from '@deck.gl/layers';\nconst bitmapLayerDefaults = {\n  wrapLongitude: true,\n  renderSubLayers: props => new BitmapLayer(props, {\n    data: null,\n    image: props.data,\n    bounds: [props.tile.bbox.west, props.tile.bbox.south, props.tile.bbox.east, props.tile.bbox.north]\n  })\n};\nconst terrainLayerDefaults = {\n  elevationDecoder: {\n    rScaler: 0,\n    gScaler: 0,\n    bScaler: 337,\n    offset: 0\n  },\n  meshMaxError: 1,\n  wrapLongitude: true,\n  workerUrl: \"./terrain-loader.worker.js\",\n  material: {\n    ambient: 0.2,\n    diffuse: 1,\n    shininess: 128,\n    specularColor: [255, 192, 64]\n  }\n};\n\nconst smoothstep = x => x * x * (3 - 2 * x);\n\nconst plusMinusSmoothStep = x => smoothstep(Math.abs(x)) * Math.sign(x);\n\nconst unsmoothstep = x => 0.5 - Math.sin(Math.asin(1 - 2 * x) / 3);\n\nclass App extends React.Component {\n  constructor(props) {\n    super(props);\n    this.state = {\n      viz: \"bumpy-light\",\n      viewState: {\n        longitude: -122.4,\n        latitude: 37.7,\n        zoom: 6,\n        pitch: 50,\n        bearing: 0,\n        maxZoom: 10\n      },\n      isDrone: true,\n      fullLoopDuration: 200,\n      pitchChange: 1,\n      bearingChange: 3,\n      tickSize: 10\n    };\n  }\n\n  componentDidMount() {\n    setTimeout(() => this.startAnimating(), 1000);\n  }\n\n  async startAnimating() {\n    const {\n      viewState: {\n        pitch,\n        bearing\n      },\n      fullLoopDuration,\n      pitchChange,\n      bearingChange,\n      tickSize\n    } = this.state;\n\n    if (typeof pitch !== \"number\" || typeof bearing !== \"number\") {\n      console.log({\n        \"deckgl appearance\": \"loading\",\n        pitch,\n        bearing,\n        pitchChange,\n        time: Date.now()\n      });\n      setTimeout(() => this.startAnimating(), 0);\n    } else {\n      // for me, on my graphics card, the map view was glitching out (blank white flashes) with transitions longer than ~10ms\n      let i = 0;\n\n      do {\n        const raf = await new Promise(resolve => requestAnimationFrame(resolve));\n        const delay = await new Promise(resolve => setTimeout(resolve, tickSize));\n        const eased = Math.sin(Math.PI * 2 * i / fullLoopDuration);\n        this.setState({\n          viewState: { ...this.state.viewState,\n            bearing: bearing + eased * bearingChange,\n            pitch: pitch + eased * pitchChange,\n            transitionDuration: tickSize,\n            onTransitionInterrupt: () => this.setState({\n              isDrone: false\n            })\n          }\n        });\n      } while (i++ < fullLoopDuration && this.state.isDrone);\n\n      if (this.state.isDrone) {\n        this.startAnimating();\n      }\n    }\n  }\n\n  render() {\n    const {\n      viz\n    } = this.state;\n    const smog = new TileLayer({ ...bitmapLayerDefaults,\n      data: './tiles/greys-{z}-{x}-{y}.png',\n      maxZoom: 8,\n      id: 'smog'\n    });\n    const watercolor = new TileLayer({ ...bitmapLayerDefaults,\n      data: './stamen-tiles/watercolor/{z}/{x}/{y}.jpg',\n      id: 'watercolor'\n    });\n    const tonerlabel = new TileLayer({ ...bitmapLayerDefaults,\n      data: './stamen-tiles/toner-labels/{z}/{x}/{y}.png',\n      id: 'tonerlabel'\n    });\n    const terrain = new TileLayer({ ...bitmapLayerDefaults,\n      data: './stamen-tiles/terrain/{z}/{x}/{y}.png',\n      id: 'greenhills'\n    });\n    const bumpyLight = new TerrainLayer({ ...terrainLayerDefaults,\n      id: 'bumpyLight',\n      elevationData: './tiles/globe-{z}-{x}-{y}.png',\n      texture: './tiles/globe-{z}-{x}-{y}.png',\n      workerUrl: \"./terrain-loader.worker.js\"\n    });\n    const bumpyTerrain = new TerrainLayer({ ...terrainLayerDefaults,\n      id: 'bumpyTerrain',\n      elevationData: './tiles/globe-{z}-{x}-{y}.png',\n      texture: './stamen-tiles/terrain/{z}/{x}/{y}.png'\n    });\n    const bumpyWatercolor = new TerrainLayer({ ...terrainLayerDefaults,\n      id: 'bumpyWatercolor',\n      elevationData: './tiles/globe-{z}-{x}-{y}.png',\n      texture: './stamen-tiles/watercolor/{z}/{x}/{y}.jpg'\n    });\n    const layerMapping = {\n      \"bumpy-light\": [bumpyLight],\n      \"bumpy-terrain\": [bumpyTerrain],\n      \"bumpy-watercolor\": [bumpyWatercolor],\n      \"hazy-terrain\": [terrain, smog],\n      \"hazy-watercolor\": [watercolor, tonerlabel, smog],\n      \"hazy-gouache\": [watercolor, smog]\n    };\n    const layers = layerMapping[viz];\n    return /*#__PURE__*/React.createElement(\"div\", {\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 130,\n        columnNumber: 7\n      }\n    }, /*#__PURE__*/React.createElement(\"div\", {\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 131,\n        columnNumber: 9\n      }\n    }, /*#__PURE__*/React.createElement(DeckGL, {\n      viewState: this.state.viewState,\n      controller: true,\n      layers: layers,\n      id: \"maincanvas\",\n      onViewStateChange: ({\n        viewState\n      }) => this.setState({\n        viewState\n      }),\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 132,\n        columnNumber: 11\n      }\n    })), /*#__PURE__*/React.createElement(\"div\", {\n      className: \"tweaks\",\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 134,\n        columnNumber: 9\n      }\n    }, /*#__PURE__*/React.createElement(\"div\", {\n      id: \"colophon\",\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 135,\n        columnNumber: 11\n      }\n    }, \"\\xA9 Lee Butterman 2020. Made in Oakland, California.\", /*#__PURE__*/React.createElement(\"br\", {\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 135,\n        columnNumber: 80\n      }\n    }), \"Map tiles by Stamen Design under \", /*#__PURE__*/React.createElement(\"a\", {\n      href: \"https://creativecommons.org/licenses/by/3.0/\",\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 135,\n        columnNumber: 118\n      }\n    }, \"CC BY 3.0\"), \". Map data by OpenStreetMap under \", /*#__PURE__*/React.createElement(\"a\", {\n      href: \"https://creativecommons.org/licenses/by-sa/3.0/\",\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 135,\n        columnNumber: 220\n      }\n    }, \"CC BY SA 3.0\")), /*#__PURE__*/React.createElement(\"div\", {\n      id: \"tweaks\",\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 136,\n        columnNumber: 11\n      }\n    }, \"View light pollution as:\", /*#__PURE__*/React.createElement(\"br\", {\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 137,\n        columnNumber: 37\n      }\n    }), /*#__PURE__*/React.createElement(\"form\", {\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 138,\n        columnNumber: 13\n      }\n    }, /*#__PURE__*/React.createElement(\"div\", {\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 139,\n        columnNumber: 15\n      }\n    }, /*#__PURE__*/React.createElement(\"label\", {\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 140,\n        columnNumber: 17\n      }\n    }, /*#__PURE__*/React.createElement(\"input\", {\n      type: \"radio\",\n      name: \"viz\",\n      value: \"bumpy-light\",\n      checked: viz === \"bumpy-light\",\n      onChange: e => this.setState({\n        viz: e.target.value\n      }),\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 141,\n        columnNumber: 19\n      }\n    }), \"topography, on a white/blue world\")), /*#__PURE__*/React.createElement(\"div\", {\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 145,\n        columnNumber: 15\n      }\n    }, /*#__PURE__*/React.createElement(\"label\", {\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 146,\n        columnNumber: 17\n      }\n    }, /*#__PURE__*/React.createElement(\"input\", {\n      type: \"radio\",\n      name: \"viz\",\n      value: \"bumpy-terrain\",\n      checked: viz === \"bumpy-terrain\",\n      onChange: e => this.setState({\n        viz: e.target.value\n      }),\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 147,\n        columnNumber: 19\n      }\n    }), \"topography, on a terrain map world\")), /*#__PURE__*/React.createElement(\"div\", {\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 151,\n        columnNumber: 15\n      }\n    }, /*#__PURE__*/React.createElement(\"label\", {\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 152,\n        columnNumber: 17\n      }\n    }, /*#__PURE__*/React.createElement(\"input\", {\n      type: \"radio\",\n      name: \"viz\",\n      value: \"bumpy-watercolor\",\n      checked: viz === \"bumpy-watercolor\",\n      onChange: e => this.setState({\n        viz: e.target.value\n      }),\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 153,\n        columnNumber: 19\n      }\n    }), \"topography, on a watercolor world\")), /*#__PURE__*/React.createElement(\"div\", {\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 157,\n        columnNumber: 15\n      }\n    }, /*#__PURE__*/React.createElement(\"label\", {\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 158,\n        columnNumber: 17\n      }\n    }, /*#__PURE__*/React.createElement(\"input\", {\n      type: \"radio\",\n      name: \"viz\",\n      value: \"hazy-terrain\",\n      checked: viz === \"hazy-terrain\",\n      onChange: e => this.setState({\n        viz: e.target.value\n      }),\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 159,\n        columnNumber: 19\n      }\n    }), \"haze, on a terrain map world\")), /*#__PURE__*/React.createElement(\"div\", {\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 163,\n        columnNumber: 15\n      }\n    }, /*#__PURE__*/React.createElement(\"label\", {\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 164,\n        columnNumber: 17\n      }\n    }, /*#__PURE__*/React.createElement(\"input\", {\n      type: \"radio\",\n      name: \"viz\",\n      value: \"hazy-watercolor\",\n      checked: viz === \"hazy-watercolor\",\n      onChange: e => this.setState({\n        viz: e.target.value\n      }),\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 165,\n        columnNumber: 19\n      }\n    }), \"haze, on a watercolor world with labels\")), /*#__PURE__*/React.createElement(\"div\", {\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 169,\n        columnNumber: 15\n      }\n    }, /*#__PURE__*/React.createElement(\"label\", {\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 170,\n        columnNumber: 17\n      }\n    }, /*#__PURE__*/React.createElement(\"input\", {\n      type: \"radio\",\n      name: \"viz\",\n      value: \"hazy-gouache\",\n      checked: viz === \"hazy-gouache\",\n      onChange: e => this.setState({\n        viz: e.target.value\n      }),\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 171,\n        columnNumber: 19\n      }\n    }), \"haze, on a watercolor world\"))), /*#__PURE__*/React.createElement(\"label\", {\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 176,\n        columnNumber: 13\n      }\n    }, /*#__PURE__*/React.createElement(\"input\", {\n      type: \"checkbox\",\n      checked: this.state.isDrone,\n      onChange: e => {\n        this.setState({\n          isDrone: e.target.checked\n        });\n        if (!this.state.isDrone) this.startAnimating();\n      },\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 177,\n        columnNumber: 15\n      }\n    }), \"drone hover\"))));\n  }\n\n}\n\nexport default App;","map":{"version":3,"sources":["/home/lsb/wikidatageo/dark-sky-vacations/src/App.js"],"names":["React","DeckGL","TerrainLayer","TileLayer","BitmapLayer","bitmapLayerDefaults","wrapLongitude","renderSubLayers","props","data","image","bounds","tile","bbox","west","south","east","north","terrainLayerDefaults","elevationDecoder","rScaler","gScaler","bScaler","offset","meshMaxError","workerUrl","material","ambient","diffuse","shininess","specularColor","smoothstep","x","plusMinusSmoothStep","Math","abs","sign","unsmoothstep","sin","asin","App","Component","constructor","state","viz","viewState","longitude","latitude","zoom","pitch","bearing","maxZoom","isDrone","fullLoopDuration","pitchChange","bearingChange","tickSize","componentDidMount","setTimeout","startAnimating","console","log","time","Date","now","i","raf","Promise","resolve","requestAnimationFrame","delay","eased","PI","setState","transitionDuration","onTransitionInterrupt","render","smog","id","watercolor","tonerlabel","terrain","bumpyLight","elevationData","texture","bumpyTerrain","bumpyWatercolor","layerMapping","layers","e","target","value","checked"],"mappings":"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","sourcesContent":["import React from 'react';\nimport './App.css';\nimport DeckGL from '@deck.gl/react';\nimport { TerrainLayer, TileLayer, } from '@deck.gl/geo-layers';\nimport { BitmapLayer,  } from '@deck.gl/layers';\n\nconst bitmapLayerDefaults = ({\n  wrapLongitude: true,\n  renderSubLayers: props => (\n    new BitmapLayer((props), {\n      data: null,\n      image: props.data,\n      bounds: [props.tile.bbox.west, props.tile.bbox.south, props.tile.bbox.east, props.tile.bbox.north],\n    })\n  ),\n})\nconst terrainLayerDefaults = ({\n  elevationDecoder: {\n    rScaler: 0,\n    gScaler: 0,\n    bScaler: 337,\n    offset: 0,\n  },\n  meshMaxError: 1,\n  wrapLongitude: true,\n  workerUrl: \"./terrain-loader.worker.js\",\n  material: {\n    ambient: 0.2,\n    diffuse: 1,\n    shininess: 128,\n    specularColor: [255, 192, 64]\n  },\n});\n\nconst smoothstep = (x) => x * x * (3 - 2 * x);\nconst plusMinusSmoothStep = (x) => smoothstep(Math.abs(x)) * Math.sign(x);\nconst unsmoothstep = (x) => 0.5 - Math.sin(Math.asin(1 - 2 * x) / 3);\n\nclass App extends React.Component {\n  constructor(props) {\n    super(props)\n    this.state = {\n      viz: \"bumpy-light\",\n      viewState: {longitude: -122.4, latitude: 37.7, zoom: 6, pitch: 50, bearing: 0, maxZoom: 10},\n      isDrone: true,\n      fullLoopDuration: 200,\n      pitchChange: 1,\n      bearingChange: 3,\n      tickSize: 10,\n    };\n  }\n  componentDidMount() {\n    setTimeout(() => this.startAnimating(), 1000);\n  }\n  async startAnimating() {\n    const {viewState: {pitch, bearing}, fullLoopDuration, pitchChange, bearingChange, tickSize} = this.state;\n    if((typeof pitch) !== \"number\" || (typeof bearing) !== \"number\") {\n      console.log({\"deckgl appearance\": \"loading\", pitch, bearing, pitchChange, time: Date.now()});\n      setTimeout(() => this.startAnimating(), 0);\n    } else {\n      // for me, on my graphics card, the map view was glitching out (blank white flashes) with transitions longer than ~10ms\n      let i = 0; \n      do {\n        const raf = await new Promise(resolve => requestAnimationFrame(resolve));\n        const delay = await new Promise(resolve => setTimeout(resolve, tickSize));\n        const eased = Math.sin(Math.PI * 2 * i / fullLoopDuration);\n        this.setState({viewState: {\n          ...this.state.viewState,\n          bearing: bearing + eased * bearingChange,\n          pitch: pitch + eased * pitchChange,\n          transitionDuration: tickSize,\n          onTransitionInterrupt: () => this.setState({isDrone: false}),\n        }})\n      } while (i++ < fullLoopDuration && this.state.isDrone);\n      if(this.state.isDrone) { this.startAnimating() }\n    }\n  }\n  render() {\n    const {viz} = this.state;\n    const smog = new TileLayer({\n      ...bitmapLayerDefaults,\n      data: './tiles/greys-{z}-{x}-{y}.png',\n      maxZoom: 8,\n      id: 'smog',\n    })\n    const watercolor = new TileLayer({\n      ...bitmapLayerDefaults,\n      data: './stamen-tiles/watercolor/{z}/{x}/{y}.jpg',\n      id: 'watercolor',\n    });\n    const tonerlabel = new TileLayer({\n      ...bitmapLayerDefaults,\n      data: './stamen-tiles/toner-labels/{z}/{x}/{y}.png',\n      id: 'tonerlabel',\n    });\n    const terrain = new TileLayer({\n      ...bitmapLayerDefaults,\n      data: './stamen-tiles/terrain/{z}/{x}/{y}.png',\n      id: 'greenhills',\n    })\n    const bumpyLight = new TerrainLayer({\n      ...terrainLayerDefaults,\n      id: 'bumpyLight',\n      elevationData: './tiles/globe-{z}-{x}-{y}.png',\n      texture: './tiles/globe-{z}-{x}-{y}.png',\n      workerUrl: \"./terrain-loader.worker.js\",\n    });\n    const bumpyTerrain = new TerrainLayer({\n      ...terrainLayerDefaults,\n      id: 'bumpyTerrain',\n      elevationData: './tiles/globe-{z}-{x}-{y}.png',\n      texture: './stamen-tiles/terrain/{z}/{x}/{y}.png',\n    });\n    const bumpyWatercolor = new TerrainLayer({\n      ...terrainLayerDefaults,\n      id: 'bumpyWatercolor',\n      elevationData: './tiles/globe-{z}-{x}-{y}.png',\n      texture: './stamen-tiles/watercolor/{z}/{x}/{y}.jpg',\n    })\n    const layerMapping = ({\n      \"bumpy-light\": [bumpyLight],\n      \"bumpy-terrain\": [bumpyTerrain],\n      \"bumpy-watercolor\": [bumpyWatercolor],\n      \"hazy-terrain\": [terrain, smog],\n      \"hazy-watercolor\": [watercolor, tonerlabel, smog],\n      \"hazy-gouache\": [watercolor, smog],\n    })\n    const layers = layerMapping[viz];\n    return (\n      <div>\n        <div>\n          <DeckGL viewState={this.state.viewState} controller={true} layers={layers} id={\"maincanvas\"} onViewStateChange={({viewState}) => this.setState({viewState})} />\n        </div>\n        <div className=\"tweaks\">\n          <div id=\"colophon\">© Lee Butterman 2020. Made in Oakland, California.<br/>Map tiles by Stamen Design under <a href=\"https://creativecommons.org/licenses/by/3.0/\">CC BY 3.0</a>. Map data by OpenStreetMap under <a href=\"https://creativecommons.org/licenses/by-sa/3.0/\">CC BY SA 3.0</a></div>\n          <div id=\"tweaks\">\n            View light pollution as:<br/>\n            <form>\n              <div>\n                <label>\n                  <input type=\"radio\" name=\"viz\" value=\"bumpy-light\" checked={viz === \"bumpy-light\"} onChange={e => this.setState({viz: e.target.value})} />\n                  topography, on a white/blue world\n                </label>\n              </div>\n              <div>\n                <label>\n                  <input type=\"radio\" name=\"viz\" value=\"bumpy-terrain\" checked={viz === \"bumpy-terrain\"} onChange={e => this.setState({viz: e.target.value})} />\n                  topography, on a terrain map world\n                </label>\n              </div>\n              <div>\n                <label>\n                  <input type=\"radio\" name=\"viz\" value=\"bumpy-watercolor\" checked={viz === \"bumpy-watercolor\"} onChange={e => this.setState({viz: e.target.value})} />\n                  topography, on a watercolor world\n                </label>\n              </div>\n              <div>\n                <label>\n                  <input type=\"radio\" name=\"viz\" value=\"hazy-terrain\" checked={viz === \"hazy-terrain\"} onChange={e => this.setState({viz: e.target.value})} />\n                  haze, on a terrain map world\n                </label>\n              </div>\n              <div>\n                <label>\n                  <input type=\"radio\" name=\"viz\" value=\"hazy-watercolor\" checked={viz === \"hazy-watercolor\"} onChange={e => this.setState({viz: e.target.value})} />\n                  haze, on a watercolor world with labels\n                </label>\n              </div>\n              <div>\n                <label>\n                  <input type=\"radio\" name=\"viz\" value=\"hazy-gouache\" checked={viz === \"hazy-gouache\"} onChange={e => this.setState({viz: e.target.value})} />\n                  haze, on a watercolor world\n                </label>\n              </div>\n            </form>\n            <label>\n              <input type=\"checkbox\" checked={this.state.isDrone} onChange={e => { this.setState({isDrone: e.target.checked}); if(!this.state.isDrone) this.startAnimating() } } />\n              drone hover\n            </label>\n          </div>          \n        </div>\n      </div>\n    )\n  }\n}\n\nexport default App;"]},"metadata":{},"sourceType":"module"}