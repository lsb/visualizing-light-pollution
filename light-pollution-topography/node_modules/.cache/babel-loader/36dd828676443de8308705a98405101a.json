{"ast":null,"code":"'use strict';\n\nmodule.exports = TinySDF;\nmodule.exports.default = TinySDF;\nvar INF = 1e20;\n\nfunction TinySDF(fontSize, buffer, radius, cutoff, fontFamily, fontWeight) {\n  this.fontSize = fontSize || 24;\n  this.buffer = buffer === undefined ? 3 : buffer;\n  this.cutoff = cutoff || 0.25;\n  this.fontFamily = fontFamily || 'sans-serif';\n  this.fontWeight = fontWeight || 'normal';\n  this.radius = radius || 8;\n  var size = this.size = this.fontSize + this.buffer * 2;\n  this.canvas = document.createElement('canvas');\n  this.canvas.width = this.canvas.height = size;\n  this.ctx = this.canvas.getContext('2d');\n  this.ctx.font = this.fontWeight + ' ' + this.fontSize + 'px ' + this.fontFamily;\n  this.ctx.textBaseline = 'middle';\n  this.ctx.fillStyle = 'black'; // temporary arrays for the distance transform\n\n  this.gridOuter = new Float64Array(size * size);\n  this.gridInner = new Float64Array(size * size);\n  this.f = new Float64Array(size);\n  this.d = new Float64Array(size);\n  this.z = new Float64Array(size + 1);\n  this.v = new Int16Array(size); // hack around https://bugzilla.mozilla.org/show_bug.cgi?id=737852\n\n  this.middle = Math.round(size / 2 * (navigator.userAgent.indexOf('Gecko/') >= 0 ? 1.2 : 1));\n}\n\nTinySDF.prototype.draw = function (char) {\n  this.ctx.clearRect(0, 0, this.size, this.size);\n  this.ctx.fillText(char, this.buffer, this.middle);\n  var imgData = this.ctx.getImageData(0, 0, this.size, this.size);\n  var alphaChannel = new Uint8ClampedArray(this.size * this.size);\n\n  for (var i = 0; i < this.size * this.size; i++) {\n    var a = imgData.data[i * 4 + 3] / 255; // alpha value\n\n    this.gridOuter[i] = a === 1 ? 0 : a === 0 ? INF : Math.pow(Math.max(0, 0.5 - a), 2);\n    this.gridInner[i] = a === 1 ? INF : a === 0 ? 0 : Math.pow(Math.max(0, a - 0.5), 2);\n  }\n\n  edt(this.gridOuter, this.size, this.size, this.f, this.d, this.v, this.z);\n  edt(this.gridInner, this.size, this.size, this.f, this.d, this.v, this.z);\n\n  for (i = 0; i < this.size * this.size; i++) {\n    var d = this.gridOuter[i] - this.gridInner[i];\n    alphaChannel[i] = Math.max(0, Math.min(255, Math.round(255 - 255 * (d / this.radius + this.cutoff))));\n  }\n\n  return alphaChannel;\n}; // 2D Euclidean distance transform by Felzenszwalb & Huttenlocher https://cs.brown.edu/~pff/papers/dt-final.pdf\n\n\nfunction edt(data, width, height, f, d, v, z) {\n  for (var x = 0; x < width; x++) {\n    for (var y = 0; y < height; y++) {\n      f[y] = data[y * width + x];\n    }\n\n    edt1d(f, d, v, z, height);\n\n    for (y = 0; y < height; y++) {\n      data[y * width + x] = d[y];\n    }\n  }\n\n  for (y = 0; y < height; y++) {\n    for (x = 0; x < width; x++) {\n      f[x] = data[y * width + x];\n    }\n\n    edt1d(f, d, v, z, width);\n\n    for (x = 0; x < width; x++) {\n      data[y * width + x] = Math.sqrt(d[x]);\n    }\n  }\n} // 1D squared distance transform\n\n\nfunction edt1d(f, d, v, z, n) {\n  v[0] = 0;\n  z[0] = -INF;\n  z[1] = +INF;\n\n  for (var q = 1, k = 0; q < n; q++) {\n    var s = (f[q] + q * q - (f[v[k]] + v[k] * v[k])) / (2 * q - 2 * v[k]);\n\n    while (s <= z[k]) {\n      k--;\n      s = (f[q] + q * q - (f[v[k]] + v[k] * v[k])) / (2 * q - 2 * v[k]);\n    }\n\n    k++;\n    v[k] = q;\n    z[k] = s;\n    z[k + 1] = +INF;\n  }\n\n  for (q = 0, k = 0; q < n; q++) {\n    while (z[k + 1] < q) {\n      k++;\n    }\n\n    d[q] = (q - v[k]) * (q - v[k]) + f[v[k]];\n  }\n}","map":{"version":3,"sources":["/dev/shm/wikidatageo/light-pollution-topography/node_modules/@mapbox/tiny-sdf/index.js"],"names":["module","exports","TinySDF","default","INF","fontSize","buffer","radius","cutoff","fontFamily","fontWeight","undefined","size","canvas","document","createElement","width","height","ctx","getContext","font","textBaseline","fillStyle","gridOuter","Float64Array","gridInner","f","d","z","v","Int16Array","middle","Math","round","navigator","userAgent","indexOf","prototype","draw","char","clearRect","fillText","imgData","getImageData","alphaChannel","Uint8ClampedArray","i","a","data","pow","max","edt","min","x","y","edt1d","sqrt","n","q","k","s"],"mappings":"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","sourcesContent":["'use strict';\n\nmodule.exports = TinySDF;\nmodule.exports.default = TinySDF;\n\nvar INF = 1e20;\n\nfunction TinySDF(fontSize, buffer, radius, cutoff, fontFamily, fontWeight) {\n    this.fontSize = fontSize || 24;\n    this.buffer = buffer === undefined ? 3 : buffer;\n    this.cutoff = cutoff || 0.25;\n    this.fontFamily = fontFamily || 'sans-serif';\n    this.fontWeight = fontWeight || 'normal';\n    this.radius = radius || 8;\n    var size = this.size = this.fontSize + this.buffer * 2;\n\n    this.canvas = document.createElement('canvas');\n    this.canvas.width = this.canvas.height = size;\n\n    this.ctx = this.canvas.getContext('2d');\n    this.ctx.font = this.fontWeight + ' ' + this.fontSize + 'px ' + this.fontFamily;\n    this.ctx.textBaseline = 'middle';\n    this.ctx.fillStyle = 'black';\n\n    // temporary arrays for the distance transform\n    this.gridOuter = new Float64Array(size * size);\n    this.gridInner = new Float64Array(size * size);\n    this.f = new Float64Array(size);\n    this.d = new Float64Array(size);\n    this.z = new Float64Array(size + 1);\n    this.v = new Int16Array(size);\n\n    // hack around https://bugzilla.mozilla.org/show_bug.cgi?id=737852\n    this.middle = Math.round((size / 2) * (navigator.userAgent.indexOf('Gecko/') >= 0 ? 1.2 : 1));\n}\n\nTinySDF.prototype.draw = function (char) {\n    this.ctx.clearRect(0, 0, this.size, this.size);\n    this.ctx.fillText(char, this.buffer, this.middle);\n\n    var imgData = this.ctx.getImageData(0, 0, this.size, this.size);\n    var alphaChannel = new Uint8ClampedArray(this.size * this.size);\n\n    for (var i = 0; i < this.size * this.size; i++) {\n        var a = imgData.data[i * 4 + 3] / 255; // alpha value\n        this.gridOuter[i] = a === 1 ? 0 : a === 0 ? INF : Math.pow(Math.max(0, 0.5 - a), 2);\n        this.gridInner[i] = a === 1 ? INF : a === 0 ? 0 : Math.pow(Math.max(0, a - 0.5), 2);\n    }\n\n    edt(this.gridOuter, this.size, this.size, this.f, this.d, this.v, this.z);\n    edt(this.gridInner, this.size, this.size, this.f, this.d, this.v, this.z);\n\n    for (i = 0; i < this.size * this.size; i++) {\n        var d = this.gridOuter[i] - this.gridInner[i];\n        alphaChannel[i] = Math.max(0, Math.min(255, Math.round(255 - 255 * (d / this.radius + this.cutoff))));\n    }\n\n    return alphaChannel;\n};\n\n// 2D Euclidean distance transform by Felzenszwalb & Huttenlocher https://cs.brown.edu/~pff/papers/dt-final.pdf\nfunction edt(data, width, height, f, d, v, z) {\n    for (var x = 0; x < width; x++) {\n        for (var y = 0; y < height; y++) {\n            f[y] = data[y * width + x];\n        }\n        edt1d(f, d, v, z, height);\n        for (y = 0; y < height; y++) {\n            data[y * width + x] = d[y];\n        }\n    }\n    for (y = 0; y < height; y++) {\n        for (x = 0; x < width; x++) {\n            f[x] = data[y * width + x];\n        }\n        edt1d(f, d, v, z, width);\n        for (x = 0; x < width; x++) {\n            data[y * width + x] = Math.sqrt(d[x]);\n        }\n    }\n}\n\n// 1D squared distance transform\nfunction edt1d(f, d, v, z, n) {\n    v[0] = 0;\n    z[0] = -INF;\n    z[1] = +INF;\n\n    for (var q = 1, k = 0; q < n; q++) {\n        var s = ((f[q] + q * q) - (f[v[k]] + v[k] * v[k])) / (2 * q - 2 * v[k]);\n        while (s <= z[k]) {\n            k--;\n            s = ((f[q] + q * q) - (f[v[k]] + v[k] * v[k])) / (2 * q - 2 * v[k]);\n        }\n        k++;\n        v[k] = q;\n        z[k] = s;\n        z[k + 1] = +INF;\n    }\n\n    for (q = 0, k = 0; q < n; q++) {\n        while (z[k + 1] < q) k++;\n        d[q] = (q - v[k]) * (q - v[k]) + f[v[k]];\n    }\n}\n"]},"metadata":{},"sourceType":"script"}