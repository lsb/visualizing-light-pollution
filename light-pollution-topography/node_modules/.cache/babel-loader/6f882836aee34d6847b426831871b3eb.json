{"ast":null,"code":"var _jsxFileName = \"/home/lsb/wikidatageo/dark-sky-vacations/src/App.js\";\nimport React from 'react';\nimport './App.css';\nimport DeckGL from '@deck.gl/react';\nimport { TerrainLayer, TileLayer } from '@deck.gl/geo-layers';\nimport { BitmapLayer, ScatterplotLayer, TextLayer } from '@deck.gl/layers';\nimport { Table } from 'apache-arrow';\n\nconst logAndReturn = x => {\n  console.log(x);\n  return x;\n};\n\nfunction getURLFromTemplate(template, properties) {\n  if (!template || !template.length) {\n    return null;\n  }\n\n  if (Array.isArray(template)) {\n    const index = Math.abs(properties.x + properties.y) % template.length;\n    template = template[index];\n  }\n\n  return template.replace(/\\{ *([\\w_-]+) *\\}/g, (_, property) => properties[property]);\n} // where can i import this from lol\n\n\nclass SingleBatchArrowTileLayer extends TileLayer {\n  async getTileData(tile) {\n    const {\n      data\n    } = this.props;\n    console.log({\n      tiledata: data\n    });\n    tile.url = getURLFromTemplate(data, tile);\n\n    if (!tile.url) {\n      return null;\n    }\n\n    const table = await Table.from(fetch(tile.url, {\n      layer: this\n    }));\n    console.log({\n      table\n    });\n    return table;\n  }\n\n}\n\nclass App extends React.Component {\n  constructor(props) {\n    super(props);\n    this.state = {\n      initialViewState: {\n        longitude: -122.4,\n        latitude: 37.7,\n        zoom: 5,\n        pitch: 30,\n        bearing: 0,\n        maxZoom: 8\n      }\n    };\n  }\n\n  render() {\n    const light = new TileLayer({\n      data: './tiles/light-{z}-{x}-{y}.png',\n      tileSize: 1024,\n      maxZoom: 6,\n      wrapLongitude: true,\n      renderSubLayers: props => new BitmapLayer(logAndReturn(props), {\n        data: null,\n        image: props.data,\n        bounds: [props.tile.bbox.west, props.tile.bbox.south, props.tile.bbox.east, props.tile.bbox.north]\n      })\n    });\n    const lumaTopo = new TerrainLayer({\n      elevationDecoder: {\n        rScaler: 500,\n        gScaler: 0,\n        bScaler: 0,\n        offset: 0\n      },\n      meshMaxError: 1,\n      elevationData: './tiles/light-{z}-{x}-{y}.png',\n      maxZoom: 8,\n      wrapLongitude: true,\n      texture: './tiles/texture-{z}-{x}-{y}.png',\n      material: {\n        ambient: 0.2,\n        diffuse: 1,\n        shininess: 128,\n        specularColor: [255, 192, 64]\n      }\n    });\n    const dataTilesPointText = new TileLayer({\n      data: './data-tiles/geo-tile-{z}-{x}-{y}-light-0.arrow',\n      maxZoom: 6,\n      wrapLongitude: true,\n      renderSubLayers: ({\n        tile: {\n          bbox: {\n            north,\n            south,\n            east,\n            west\n          }\n        },\n        data\n      }) => {\n        data.then(thendata => console.log({\n          thendata\n        }));\n        const points = new ScatterplotLayer({\n          id: `points-${north}-${south}-${east}-${west}`,\n          data: Table.from(data),\n          pickable: true,\n          onHover: ({\n            index,\n            picked\n          }) => this.setState({\n            pointpick: picked ? data.get(index) : null\n          }),\n          getRadius: 10,\n          wrapLongitude: true,\n          getPosition: (object, {\n            index,\n            data: table,\n            target\n          }) => {\n            if (index < 10) {\n              console.log({\n                index,\n                table,\n                object\n              });\n            }\n\n            const {\n              gt_lat,\n              gt_lon\n            } = table.get(index);\n            return [gt_lon, gt_lat];\n          },\n          getFillColor: [100, 100, 150],\n          getLineColor: [0, 0, 0]\n        });\n        return [points];\n      }\n    });\n    const textPick = !this.state.pointpick ? null : new TextLayer({\n      id: `title-${this.state.pointpick.item_id}`,\n      data: [this.state.pointpick.site_page],\n      pickable: false,\n      characterSet: this.state.pointpick.site_page.split(''),\n      backgroundColor: [255, 255, 255],\n      getText: d => `   ${d}   `,\n      getSize: 20,\n      sizeUnits: 'pixels',\n      wrapLongitude: true,\n      getPosition: [this.state.pointpick.gt_lon, this.state.pointpick.gt_lat]\n    });\n    return /*#__PURE__*/React.createElement(\"div\", {\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 109,\n        columnNumber: 7\n      }\n    }, /*#__PURE__*/React.createElement(\"div\", {\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 110,\n        columnNumber: 9\n      }\n    }, /*#__PURE__*/React.createElement(DeckGL, {\n      initialViewState: this.state.initialViewState,\n      controller: true,\n      layers: [lumaTopo, dataTilesPointText, textPick],\n      id: \"maincanvas\",\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 111,\n        columnNumber: 11\n      }\n    })), /*#__PURE__*/React.createElement(\"div\", {\n      id: \"colophon\",\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 113,\n        columnNumber: 9\n      }\n    }, \"\\xA9 Lee Butterman 2020. Made in Oakland, California.\"), /*#__PURE__*/React.createElement(\"div\", {\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 114,\n        columnNumber: 9\n      }\n    }));\n  }\n\n}\n\nexport default App;","map":{"version":3,"sources":["/home/lsb/wikidatageo/dark-sky-vacations/src/App.js"],"names":["React","DeckGL","TerrainLayer","TileLayer","BitmapLayer","ScatterplotLayer","TextLayer","Table","logAndReturn","x","console","log","getURLFromTemplate","template","properties","length","Array","isArray","index","Math","abs","y","replace","_","property","SingleBatchArrowTileLayer","getTileData","tile","data","props","tiledata","url","table","from","fetch","layer","App","Component","constructor","state","initialViewState","longitude","latitude","zoom","pitch","bearing","maxZoom","render","light","tileSize","wrapLongitude","renderSubLayers","image","bounds","bbox","west","south","east","north","lumaTopo","elevationDecoder","rScaler","gScaler","bScaler","offset","meshMaxError","elevationData","texture","material","ambient","diffuse","shininess","specularColor","dataTilesPointText","then","thendata","points","id","pickable","onHover","picked","setState","pointpick","get","getRadius","getPosition","object","target","gt_lat","gt_lon","getFillColor","getLineColor","textPick","item_id","site_page","characterSet","split","backgroundColor","getText","d","getSize","sizeUnits"],"mappings":"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","sourcesContent":["import React from 'react';\nimport './App.css';\nimport DeckGL from '@deck.gl/react';\nimport { TerrainLayer, TileLayer } from '@deck.gl/geo-layers';\nimport { BitmapLayer, ScatterplotLayer, TextLayer } from '@deck.gl/layers';\nimport { Table } from 'apache-arrow';\n\nconst logAndReturn = (x) => { console.log(x); return x };\n\nfunction getURLFromTemplate(template, properties) {\n  if (!template || !template.length) {\n    return null;\n  }\n  if (Array.isArray(template)) {\n    const index = Math.abs(properties.x + properties.y) % template.length;\n    template = template[index];\n  }\n  return template.replace(/\\{ *([\\w_-]+) *\\}/g, (_, property) => properties[property]);\n} // where can i import this from lol\n\nclass SingleBatchArrowTileLayer extends TileLayer {\n  async getTileData(tile) {\n    const {data} = this.props;\n    console.log({tiledata: data});\n    tile.url = getURLFromTemplate(data, tile);\n    if(!tile.url) { return null }\n    const table = await Table.from(fetch(tile.url, {layer: this}));\n    console.log({table});\n    return table;\n  }\n}\n\nclass App extends React.Component {\n  constructor(props) {\n    super(props)\n    this.state = {initialViewState: {longitude: -122.4, latitude: 37.7, zoom: 5, pitch: 30, bearing: 0, maxZoom: 8}}\n  }\n  render() {\n    const light = new TileLayer({\n      data: './tiles/light-{z}-{x}-{y}.png',\n      tileSize: 1024,\n      maxZoom: 6,\n      wrapLongitude: true,\n      renderSubLayers: props => (\n        new BitmapLayer(logAndReturn(props), {\n          data: null,\n          image: props.data,\n          bounds: [props.tile.bbox.west, props.tile.bbox.south, props.tile.bbox.east, props.tile.bbox.north],\n        })\n      )\n    })\n    const lumaTopo = new TerrainLayer({\n      elevationDecoder: {\n        rScaler: 500,\n        gScaler: 0,\n        bScaler: 0,\n        offset: 0,\n      },\n      meshMaxError: 1,\n      elevationData: './tiles/light-{z}-{x}-{y}.png',\n      maxZoom: 8,\n      wrapLongitude: true,\n      texture: './tiles/texture-{z}-{x}-{y}.png',\n      material: {\n        ambient: 0.2,\n        diffuse: 1,\n        shininess: 128,\n        specularColor: [255, 192, 64]\n      }\n    });\n    const dataTilesPointText = new TileLayer({\n      data: './data-tiles/geo-tile-{z}-{x}-{y}-light-0.arrow',\n      maxZoom: 6,\n      wrapLongitude: true,\n      renderSubLayers: ({tile: {bbox: {north, south, east, west}}, data}) => {\n        data.then(thendata => console.log({thendata}));\n        const points = new ScatterplotLayer({\n          id: `points-${north}-${south}-${east}-${west}`,\n          data: Table.from(data),\n          pickable: true,\n          onHover: ({index, picked}) => this.setState({\n            pointpick: picked ? data.get(index) : null}),\n          getRadius: 10,\n          wrapLongitude: true,\n          getPosition: (object, {index, data: table, target}) => {\n            if(index < 10) { console.log({index, table, object})}\n            const {gt_lat, gt_lon} = table.get(index);\n            return [gt_lon, gt_lat];\n          },\n          getFillColor: [100,100,150],\n          getLineColor: [0,0,0],  \n        });\n        return [points];\n      }\n    });\n    const textPick = !this.state.pointpick ? null : new TextLayer({\n      id: `title-${this.state.pointpick.item_id}`,\n      data: [this.state.pointpick.site_page],\n      pickable: false,\n      characterSet: this.state.pointpick.site_page.split(''),\n      backgroundColor: [255,255,255],\n      getText: (d) => `   ${d}   `,\n      getSize: 20,\n      sizeUnits: 'pixels',\n      wrapLongitude: true,\n      getPosition: [this.state.pointpick.gt_lon, this.state.pointpick.gt_lat],\n    });\n    return (\n      <div>\n        <div>\n          <DeckGL initialViewState={this.state.initialViewState} controller={true} layers={[lumaTopo, dataTilesPointText, textPick]} id={\"maincanvas\"} />\n        </div>\n        <div id=\"colophon\">© Lee Butterman 2020. Made in Oakland, California.</div>\n        <div>\n          \n        </div>\n      </div>\n    )\n  }\n}\n\nexport default App;\n"]},"metadata":{},"sourceType":"module"}