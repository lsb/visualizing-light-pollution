{"version":3,"sources":["../../src/tiles-3d-loader.js"],"names":["VERSION","path","TILESET_TYPE","LOD_METRIC_TYPE","parse3DTile","normalizeTileHeaders","getBaseUri","tileset","dirname","url","parseTile","arrayBuffer","options","context","tile","content","byteOffset","parseTileset","data","tilesetJson","JSON","parse","TextDecoder","decode","loader","Tiles3DLoader","basePath","root","type","TILES3D","lodMetricType","GEOMETRIC_ERROR","lodMetricValue","loaderOptions","isTileset","indexOf","id","name","version","extensions","mimeType","test","loadGLTF","decodeQuantizedPositions"],"mappings":"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","sourcesContent":["/* global TextDecoder,  __VERSION__ */ // __VERSION__ is injected by babel-plugin-version-inline\n\nconst VERSION = typeof __VERSION__ !== 'undefined' ? __VERSION__ : 'latest';\n\nimport {path} from '@loaders.gl/loader-utils';\nimport {TILESET_TYPE, LOD_METRIC_TYPE} from '@loaders.gl/tiles';\n\nimport {parse3DTile} from './lib/parsers/parse-3d-tile';\nimport {normalizeTileHeaders} from './lib/parsers/parse-3d-tile-header';\n\nfunction getBaseUri(tileset) {\n  return path.dirname(tileset.url);\n}\n\nasync function parseTile(arrayBuffer, options, context) {\n  const tile = {};\n  tile.content = tile.content || {};\n  const byteOffset = 0;\n  await parse3DTile(arrayBuffer, byteOffset, options, context, tile.content);\n  return tile.content;\n}\n\nasync function parseTileset(data, options, context) {\n  const tilesetJson = JSON.parse(new TextDecoder().decode(data));\n  // eslint-disable-next-line no-use-before-define\n  tilesetJson.loader = options.loader || Tiles3DLoader;\n  tilesetJson.url = context.url;\n  // base path that non-absolute paths in tileset are relative to.\n  tilesetJson.basePath = getBaseUri(tilesetJson);\n  tilesetJson.root = normalizeTileHeaders(tilesetJson);\n  tilesetJson.type = TILESET_TYPE.TILES3D;\n\n  tilesetJson.lodMetricType = LOD_METRIC_TYPE.GEOMETRIC_ERROR;\n  tilesetJson.lodMetricValue = tilesetJson.root.lodMetricValue;\n\n  return tilesetJson;\n}\n\nasync function parse(data, options, context, loader) {\n  // auto detect file type\n  const loaderOptions = options['3d-tiles'] || {};\n  let isTileset;\n  if ('isTileset' in loaderOptions) {\n    isTileset = options.isTileset;\n  } else {\n    isTileset = context.url && context.url.indexOf('.json') !== -1;\n  }\n\n  if (isTileset) {\n    data = await parseTileset(data, options, context, loader);\n  } else {\n    data = await parseTile(data, options, context);\n  }\n\n  return data;\n}\n\n// Tiles3DLoader\nconst Tiles3DLoader = {\n  id: '3d-tiles',\n  name: '3D Tiles',\n  version: VERSION,\n  extensions: ['json', 'cmpt', 'pnts', 'b3dm', 'i3dm'],\n  mimeType: 'application/octet-stream',\n  test: ['json', 'cmpt', 'pnts', 'b3dm', 'i3dm'],\n  parse,\n  options: {\n    '3d-tiles': {\n      loadGLTF: true,\n      decodeQuantizedPositions: false\n    }\n  }\n};\n\nexport default Tiles3DLoader;\n"],"file":"tiles-3d-loader.js"}