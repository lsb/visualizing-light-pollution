{"version":3,"sources":["../../../src/mvt-layer/mvt-layer.js"],"names":["Matrix4","MVTLoader","load","COORDINATE_SYSTEM","TileLayer","getURLFromTemplate","ClipExtension","WORLD_SIZE","MVTLayer","getTileData","tile","url","props","data","Promise","reject","getLoadOptions","renderSubLayers","worldScale","Math","pow","z","xScale","yScale","xOffset","x","yOffset","y","modelMatrix","translate","scale","coordinateSystem","CARTESIAN","extensions","layerName"],"mappings":"AAAA,SAAQA,OAAR,QAAsB,SAAtB;AACA,SAAQC,SAAR,QAAwB,iBAAxB;AACA,SAAQC,IAAR,QAAmB,kBAAnB;AACA,SAAQC,iBAAR,QAAgC,eAAhC;AAEA,OAAOC,SAAP,MAAsB,0BAAtB;AACA,SAAQC,kBAAR,QAAiC,qBAAjC;AACA,OAAOC,aAAP,MAA0B,kBAA1B;AAEA,MAAMC,UAAU,GAAG,GAAnB;AAEA,eAAe,MAAMC,QAAN,SAAuBJ,SAAvB,CAAiC;AAC9CK,EAAAA,WAAW,CAACC,IAAD,EAAO;AAChB,UAAMC,GAAG,GAAGN,kBAAkB,CAAC,KAAKO,KAAL,CAAWC,IAAZ,EAAkBH,IAAlB,CAA9B;;AACA,QAAI,CAACC,GAAL,EAAU;AACR,aAAOG,OAAO,CAACC,MAAR,CAAe,aAAf,CAAP;AACD;;AACD,WAAOb,IAAI,CAACS,GAAD,EAAMV,SAAN,EAAiB,KAAKe,cAAL,EAAjB,CAAX;AACD;;AAEDC,EAAAA,eAAe,CAACL,KAAD,EAAQ;AACrB,UAAM;AAACF,MAAAA;AAAD,QAASE,KAAf;AACA,UAAMM,UAAU,GAAGC,IAAI,CAACC,GAAL,CAAS,CAAT,EAAYV,IAAI,CAACW,CAAjB,CAAnB;AAEA,UAAMC,MAAM,GAAGf,UAAU,GAAGW,UAA5B;AACA,UAAMK,MAAM,GAAG,CAACD,MAAhB;AAEA,UAAME,OAAO,GAAIjB,UAAU,GAAGG,IAAI,CAACe,CAAnB,GAAwBP,UAAxC;AACA,UAAMQ,OAAO,GAAGnB,UAAU,IAAI,IAAIG,IAAI,CAACiB,CAAL,GAAST,UAAjB,CAA1B;AAEA,UAAMU,WAAW,GAAG,IAAI5B,OAAJ,GAAc6B,SAAd,CAAwB,CAACL,OAAD,EAAUE,OAAV,EAAmB,CAAnB,CAAxB,EAA+CI,KAA/C,CAAqD,CAACR,MAAD,EAASC,MAAT,EAAiB,CAAjB,CAArD,CAApB;AAEAX,IAAAA,KAAK,CAACgB,WAAN,GAAoBA,WAApB;AACAhB,IAAAA,KAAK,CAACmB,gBAAN,GAAyB5B,iBAAiB,CAAC6B,SAA3C;AACApB,IAAAA,KAAK,CAACqB,UAAN,GAAmB,CAAC,IAAIrB,KAAK,CAACqB,UAAN,IAAoB,EAAxB,CAAD,EAA8B,IAAI3B,aAAJ,EAA9B,CAAnB;AAEA,WAAO,MAAMW,eAAN,CAAsBL,KAAtB,CAAP;AACD;;AA1B6C;AA6BhDJ,QAAQ,CAAC0B,SAAT,GAAqB,UAArB","sourcesContent":["import {Matrix4} from 'math.gl';\nimport {MVTLoader} from '@loaders.gl/mvt';\nimport {load} from '@loaders.gl/core';\nimport {COORDINATE_SYSTEM} from '@deck.gl/core';\n\nimport TileLayer from '../tile-layer/tile-layer';\nimport {getURLFromTemplate} from '../tile-layer/utils';\nimport ClipExtension from './clip-extension';\n\nconst WORLD_SIZE = 512;\n\nexport default class MVTLayer extends TileLayer {\n  getTileData(tile) {\n    const url = getURLFromTemplate(this.props.data, tile);\n    if (!url) {\n      return Promise.reject('Invalid URL');\n    }\n    return load(url, MVTLoader, this.getLoadOptions());\n  }\n\n  renderSubLayers(props) {\n    const {tile} = props;\n    const worldScale = Math.pow(2, tile.z);\n\n    const xScale = WORLD_SIZE / worldScale;\n    const yScale = -xScale;\n\n    const xOffset = (WORLD_SIZE * tile.x) / worldScale;\n    const yOffset = WORLD_SIZE * (1 - tile.y / worldScale);\n\n    const modelMatrix = new Matrix4().translate([xOffset, yOffset, 0]).scale([xScale, yScale, 1]);\n\n    props.modelMatrix = modelMatrix;\n    props.coordinateSystem = COORDINATE_SYSTEM.CARTESIAN;\n    props.extensions = [...(props.extensions || []), new ClipExtension()];\n\n    return super.renderSubLayers(props);\n  }\n}\n\nMVTLayer.layerName = 'MVTLayer';\n"],"file":"mvt-layer.js"}